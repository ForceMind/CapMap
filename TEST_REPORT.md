# 测试报告 (Test Report)

## 测试概况
- **测试时间**: 2026-01-21
- **测试环境**: Python 3.12, Windows
- **测试目标**: 验证 Tushare 数据接口替换及系统稳定性

## 测试结果摘要

| 功能模块 | 测试项 | 结果 | 备注 |
| :--- | :--- | :--- | :--- |
| **数据加载** | 此前 AkShare 历史数据接口 | **已替换** | 已迁移至 `ts.pro_bar` |
| **数据加载** | Tushare API 连通性 | **通过** | Token 有效，可获取成分股及日线 |
| **数据加载** | API 速率限制 (Rate Limit) | **已修复** | 发现并发请求导致 429 错误 (50次/分)。已改为串行+延时(1.25s)执行。 |
| **数据加载** | 分时数据 (Minute) | **受限** | Tushare 分时接口限制 (2次/分) 且需积分。已增加 AkShare 降级重试逻辑。 |
| **可视化** | App 启动及加载 | **通过** | 数据结构兼容，后续可视化模块无需修改。 |

## 已修复的问题
1. **API 频次超限**: 在使用 Tushare 获取沪深300成分股及日线数据时，原多线程方案（ThreadPoolExecutor）瞬间触发 "每分钟最多访问50次" 的报错。
   - **修复方案**: `modules/data_loader.py` 中将多线程改为单线程串行循环，并强制增加 `time.sleep(1.25)` 间隔。同步所有数据的耗时显著增加（约6-10分钟/300只股票），但保证了稳定性。

2. **分时数据缺失**: Tushare 免费积分无法有效支持高频分钟级数据获取。
   - **修复方案**: 在 `fetch_cached_min_data` 中增加了 AkShare (`ak.stock_zh_a_minute`) 作为备用源。当 Tushare 返回空或报错时，自动尝试从 AkShare 获取近期分时数据。

## 遗留风险/建议
- **AkShare 数据质量**: 测试中发现 AkShare 分时接口偶尔返回 NaN 数据，需留意数据源稳定性。
- **初次加载耗时**: 由于 Tushare 的限流，首次加载 "沪深300" 全量数据需要较长时间。建议用户尽量避免频繁点击 "刷新全部数据"。

## 操作指南
- 运行主程序: `streamlit run app.py`
- 运行接口测试: `python tests/test_new_loader.py`
